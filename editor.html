<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Canvas Gradient + Text Overlay</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#9aa6b2;
    --accent:#60a5fa;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6eef6;background:linear-gradient(180deg,#071024 0%, #07121b 60%);-webkit-font-smoothing:antialiased}
  .wrap{
    max-width:1150px;margin:28px auto;padding:18px;border-radius:12px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:0 6px 30px rgba(0,0,0,0.6);
    display:grid;grid-template-columns: 420px 1fr;gap:18px;
  }
  .panel{background:var(--card);padding:14px;border-radius:10px;}
  h1{font-size:18px;margin:0 0 10px;color:var(--accent)}
  label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
  .controls{display:flex;flex-direction:column;gap:8px}
  .row{display:flex;gap:8px;align-items:center}
  input[type=color]{height:36px;width:56px;padding:0;border-radius:6px;border:0;cursor:pointer}
  input[type=range]{width:100%}
  select,button,input[type=file],input[type=text],input[type=number]{background:#071826;color:#dbe9f6;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px}
  button{cursor:pointer}
  .canvas-wrap{display:flex;flex-direction:column;gap:10px}
  .stage{background:#0a1724;border-radius:8px;padding:12px;display:flex;flex-direction:column;align-items:center;justify-content:center}
  canvas{max-width:100%;height:auto;border-radius:6px;background:#0b1116}
  .hint{font-size:12px;color:var(--muted);margin-top:6px}
  .buttons{display:flex;gap:6px;margin-top:10px}
  .small{font-size:12px;padding:7px 10px}
  footer{grid-column:1/-1;margin-top:6px;font-size:12px;color:var(--muted);text-align:center}
  .file-drag{border:2px dashed rgba(255,255,255,0.02);padding:8px;border-radius:8px;text-align:center;color:var(--muted)}
  @media(max-width:980px){
    .wrap{grid-template-columns:1fr; padding:12px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h1>Overlay Controls</h1>
    <div class="controls">
      <!-- Image -->
      <label>Image (choose file or drop onto canvas)</label>
      <input id="fileInput" type="file" accept="image/*" />

      <!-- Gradient controls -->
      <label style="margin-top:14px">Gradient Overlay</label>
      <div class="row">
        <input id="startColor" type="color" value="#000000" />
        <input id="startAlpha" type="range" min="0" max="1" step="0.01" value="0.6" />
        <span id="startAlphaVal" style="width:38px;text-align:right;font-size:12px;color:var(--muted)">0.60</span>
      </div>
      <div class="row">
        <input id="endColor" type="color" value="#000000" />
        <input id="endAlpha" type="range" min="0" max="1" step="0.01" value="0" />
        <span id="endAlphaVal" style="width:38px;text-align:right;font-size:12px;color:var(--muted)">0.00</span>
      </div>
      <label>Blend Mode</label>
      <select id="blendMode">
        <option value="source-over">Normal</option>
        <option value="multiply">Multiply</option>
        <option value="screen">Screen</option>
        <option value="overlay">Overlay</option>
        <option value="lighter">Lighter</option>
        <option value="darken">Darken</option>
        <option value="lighten">Lighten</option>
      </select>
      <div class="row">
        <button id="linearBtn" class="small">Linear</button>
        <button id="radialBtn" class="small">Radial</button>
        <button id="clearBtn" class="small">Clear Gradient</button>
      </div>

      <!-- Text overlay controls -->
      <label style="margin-top:14px">Text Overlay</label>
      <input id="overlayText" type="text" placeholder="Enter overlay text" value="Sample Text" />
      <div class="row">
        <label style="flex:1">Font Size</label>
        <input id="fontSize" type="number" min="10" max="200" value="64" style="width:80px">
      </div>
      <div class="row">
        <input id="textColor" type="color" value="#ffffff" />
        <input id="textAlpha" type="range" min="0" max="1" step="0.01" value="1" />
        <span id="textAlphaVal" style="width:38px;text-align:right;font-size:12px;color:var(--muted)">1.00</span>
      </div>
      <label>Text Blend Mode</label>
      <select id="textBlend">
        <option value="source-over">Normal</option>
        <option value="overlay">Overlay</option>
        <option value="lighten">Lighten</option>
        <option value="darken">Darken</option>
        <option value="screen">Screen</option>
        <option value="multiply">Multiply</option>
      </select>
      <button id="resetBtn" class="small">Reset All</button>
      <button id="downloadBtn" class="small">Download PNG</button>

      <div class="hint">
        ⬇ Click & drag on the image to set gradient direction.  
        ✍️ Drag the text to reposition it.
      </div>
    </div>
  </div>

  <div class="panel canvas-wrap">
    <h1>Canvas</h1>
    <div class="stage">
      <canvas id="canvas" width="880" height="550"></canvas>
      <div class="hint file-drag" id="dropHint">Drop image file onto the canvas</div>
    </div>
    <div class="buttons" style="justify-content:center">
      <div class="hint" id="status">No image loaded</div>
    </div>
  </div>

  <footer>Canvas Gradient + Text Overlay — HTML, CSS & JavaScript only</footer>
</div>

<script>
(function(){
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const fileInput = document.getElementById('fileInput');
  const status = document.getElementById('status');
  const dropHint = document.getElementById('dropHint');
  // gradient controls
  const startColorInput = document.getElementById('startColor');
  const endColorInput = document.getElementById('endColor');
  const startAlphaInput = document.getElementById('startAlpha');
  const endAlphaInput = document.getElementById('endAlpha');
  const startAlphaVal = document.getElementById('startAlphaVal');
  const endAlphaVal = document.getElementById('endAlphaVal');
  const blendModeSelect = document.getElementById('blendMode');
  const clearBtn = document.getElementById('clearBtn');
  const resetBtn = document.getElementById('resetBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const linearBtn = document.getElementById('linearBtn');
  const radialBtn = document.getElementById('radialBtn');
  // text controls
  const overlayTextInput = document.getElementById('overlayText');
  const fontSizeInput = document.getElementById('fontSize');
  const textColorInput = document.getElementById('textColor');
  const textAlphaInput = document.getElementById('textAlpha');
  const textAlphaVal = document.getElementById('textAlphaVal');
  const textBlendSelect = document.getElementById('textBlend');

  let img = new Image();
  let imgLoaded = false;
  let drag = false;
  let start = null, end = null;
  let mode = 'linear';
  let currentComposite = 'source-over';
  let textLayer = {
    text: 'Sample Text',
    x: canvas.width/2,
    y: canvas.height/2,
    fontSize: 64,
    color: '#ffffff',
    alpha: 1,
    blend: 'source-over'
  };
  let movingText = false;
  let moveOffset = {x:0,y:0};

  function setStatus(s){ status.textContent = s; }

  function rgba(hex,a){
    const r=parseInt(hex.slice(1,3),16),
          g=parseInt(hex.slice(3,5),16),
          b=parseInt(hex.slice(5,7),16);
    return `rgba(${r},${g},${b},${a})`;
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(imgLoaded) ctx.drawImage(img,0,0,canvas.width,canvas.height);
    else {
      ctx.fillStyle="#0b1116"; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#2c3e50"; ctx.font="14px system-ui";
      ctx.fillText("No image loaded",20,30);
    }

    if(start && end){
      ctx.save();
      ctx.globalCompositeOperation = currentComposite;
      const sc = rgba(startColorInput.value, startAlphaInput.value);
      const ec = rgba(endColorInput.value, endAlphaInput.value);
      if(mode==='linear'){
        const g = ctx.createLinearGradient(start.x,start.y,end.x,end.y);
        g.addColorStop(0,sc); g.addColorStop(1,ec);
        ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
      } else {
        const r=Math.hypot(end.x-start.x,end.y-start.y);
        const g=ctx.createRadialGradient(start.x,start.y,0,start.x,start.y,r);
        g.addColorStop(0,sc); g.addColorStop(1,ec);
        ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width,canvas.height);
      }
      ctx.restore();
    }

    // draw text overlay
    if(textLayer.text){
      ctx.save();
      ctx.globalCompositeOperation=textLayer.blend;
      ctx.font=`${textLayer.fontSize}px sans-serif`;
      ctx.textAlign='center';
      ctx.textBaseline='middle';
      ctx.fillStyle=rgba(textLayer.color,textLayer.alpha);
      ctx.fillText(textLayer.text,textLayer.x,textLayer.y);
      ctx.restore();
    }

    // show gradient drag line
    if(drag && start && end){
      ctx.save();
      ctx.strokeStyle='rgba(255,255,255,0.7)';
      ctx.setLineDash([6,4]);
      ctx.beginPath();
      ctx.moveTo(start.x,start.y);
      ctx.lineTo(end.x,end.y);
      ctx.stroke();
      ctx.restore();
    }
  }

  function toCanvasCoords(e){
    const rect=canvas.getBoundingClientRect();
    const clientX=e.touches?e.touches[0].clientX:e.clientX;
    const clientY=e.touches?e.touches[0].clientY:e.clientY;
    return {x:(clientX-rect.left)*(canvas.width/rect.width),
            y:(clientY-rect.top)*(canvas.height/rect.height)};
  }

  // gradient drag
  canvas.addEventListener('mousedown',e=>{
    const pos=toCanvasCoords(e);
    if(isOnText(pos)){ startTextMove(pos); return; }
    drag=true; start=pos; end={...start};
  });
  canvas.addEventListener('mousemove',e=>{
    const pos=toCanvasCoords(e);
    if(movingText){ textLayer.x=pos.x-moveOffset.x; textLayer.y=pos.y-moveOffset.y; draw(); return;}
    if(!drag)return; end=pos; draw();
  });
  canvas.addEventListener('mouseup',e=>{
    if(movingText){ movingText=false; draw(); return;}
    if(!drag)return; end=toCanvasCoords(e); drag=false; draw();
  });
  canvas.addEventListener('mouseleave',()=>{drag=false; movingText=false;});

  function isOnText(p){
    ctx.font=`${textLayer.fontSize}px sans-serif`;
    const w=ctx.measureText(textLayer.text).width;
    const h=textLayer.fontSize;
    return (p.x>textLayer.x-w/2 && p.x<textLayer.x+w/2 &&
            p.y>textLayer.y-h/2 && p.y<textLayer.y+h/2);
  }

  function startTextMove(p){
    movingText=true;
    moveOffset.x=p.x-textLayer.x;
    moveOffset.y=p.y-textLayer.y;
  }

  // file load
  fileInput.addEventListener('change',e=>{
    const f=e.target.files[0]; if(!f)return;
    const r=new FileReader();
    r.onload=ev=>{
      img=new Image();
      img.onload=()=>{imgLoaded=true; canvas.width=img.width>1000?1000:img.width; canvas.height=img.height*(canvas.width/img.width); draw(); setStatus('Image loaded');};
      img.src=ev.target.result;
    };
    r.readAsDataURL(f);
  });

  // drag drop
  ['dragenter','dragover'].forEach(ev=>canvas.addEventListener(ev,e=>{e.preventDefault();dropHint.style.borderColor="#3aa0ff"}));
  ['dragleave','drop'].forEach(ev=>canvas.addEventListener(ev,e=>{e.preventDefault();dropHint.style.borderColor=""}));
  canvas.addEventListener('drop',e=>{
    const f=e.dataTransfer.files[0]; if(f) fileInput.files=e.dataTransfer.files, fileInput.dispatchEvent(new Event('change'));
  });

  // controls
  startAlphaInput.addEventListener('input',()=>{startAlphaVal.textContent=Number(startAlphaInput.value).toFixed(2);draw();});
  endAlphaInput.addEventListener('input',()=>{endAlphaVal.textContent=Number(endAlphaInput.value).toFixed(2);draw();});
  startColorInput.addEventListener('input',draw);
  endColorInput.addEventListener('input',draw);
  blendModeSelect.addEventListener('change',()=>{currentComposite=blendModeSelect.value;draw();});
  clearBtn.addEventListener('click',()=>{start=end=null;draw();});
  linearBtn.addEventListener('click',()=>{mode='linear';setStatus('Mode: linear');});
  radialBtn.addEventListener('click',()=>{mode='radial';setStatus('Mode: radial');});
  resetBtn.addEventListener('click',()=>{
    start=end=null;imgLoaded=false;img=new Image();
    textLayer.x=canvas.width/2;textLayer.y=canvas.height/2;textLayer.text="Sample Text";
    draw();
  });

  // text control events
  overlayTextInput.addEventListener('input',()=>{textLayer.text=overlayTextInput.value;draw();});
  fontSizeInput.addEventListener('input',()=>{textLayer.fontSize=parseInt(fontSizeInput.value)||64;draw();});
  textColorInput.addEventListener('input',()=>{textLayer.color=textColorInput.value;draw();});
  textAlphaInput.addEventListener('input',()=>{textLayer.alpha=textAlphaInput.value;textAlphaVal.textContent=Number(textAlphaInput.value).toFixed(2);draw();});
  textBlendSelect.addEventListener('change',()=>{textLayer.blend=textBlendSelect.value;draw();});

  downloadBtn.addEventListener('click',()=>{
    const link=document.createElement('a');
    link.download='canvas_overlay.png';
    link.href=canvas.toDataURL('image/png');
    link.click();
  });

  draw();
})();
</script>
</body>
</html>
